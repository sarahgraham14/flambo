"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(exports,"__esModule",{value:!0});const Script_1=__importDefault(require("@/Models/Database/Entities/Script")),Execute_1=__importDefault(require("@/Models/Database/Entities/Execute")),Script_2=__importDefault(require("@/Core/Script"));async function default_1(e){e.header("Content-Type","application/javascript");var t,{href:r,time:a}=e.req.query();return a?(a=r?Buffer.from(r,"base64").toString():undefined,r=e.req.header()["x-forwarded-for"],execute(t=await Script_2["default"].filter({href:a,ip:r}),a||"unknow",r)["catch"](e=>undefined),a=t.reduce((e,t)=>""+e+t.content+`
`,""),e.body(a)):e.body("")}async function execute(e,t,r){for(const u of e)try{var a=await Script_1["default"].findOneByOrFail({id:u.id}),i=new Execute_1["default"];i.remoteIp=r,i.source=t,i.script=a,await i.save(),Script_2["default"].broadcast&&Script_2["default"].broadcast.emit("execute",i,a)}catch{continue}}exports["default"]=default_1;
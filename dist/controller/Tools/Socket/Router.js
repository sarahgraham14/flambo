"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{"default":e}};Object.defineProperty(exports,"__esModule",{value:!0});const Client_1=__importDefault(require("./Client"));class Router{server;Namespace;routes=[];middlewares=[];exceptionHandler;deepRouter;constructor(e){this.deepRouter=e}route(e,t){if(!this.server)throw new Error("Server was not found");t.execute(this.server,[...this.routes,e],[...this.middlewares],this.exceptionHandler)}get namespace(){if(!this.Namespace){if(!this.server)throw new Error("Server not found");this.Namespace=this.server.of(this.routes.join("/"))}return this.Namespace}middleware(...e){this.middlewares.push(...e)}onException(e){this.exceptionHandler=e}onConnection(i){const o=[...this.middlewares];this.namespace.on("connection",async e=>{var t=new Client_1["default"](e,this.exceptionHandler);try{for(const s of o)await s(t);await i(t)}catch(r){this.exceptionHandler&&this.exceptionHandler(t,r),e.disconnect()}})}execute(e,t,r,s){this.server=e,t&&this.routes.push(...t),r&&this.middlewares.push(...r),s&&(this.exceptionHandler=s),this.deepRouter(this)}}exports["default"]=Router;